{% assign levels = false %}
{% assign functions = false %}
{% assign useWith = false %}

{% for level in product.metafields.custom.level.value %}
  {% if level == product_level %}
    {% assign levels = true  %}
  {% endif %}
{% endfor %}

{% for function in product.metafields.custom.functions.value %}
  {% if product_function == 'all' %}
    {% assign functions = true  %}
  {% elsif function == product_function %}
    {% assign functions = true  %}
  {% endif %}

{% endfor %}
{% for use_with in product.metafields.custom.use_with.value %}
  {% if product_use_with == 'all' %}
    {% assign useWith = true  %}
  {% elsif use_with == product_use_with %}
    {% assign useWith = true  %}
  {% endif %}
{% endfor %}

{%if levels == true and useWith == true and functions == true %}
<article class="s-card" data-pointer-area="View" data-filter-brand="1" data-filter-colour="brown" data-scroll data-scroll-call="is-in-view">
  <div class="s-card__inner border-image border-image--small-primary-star">
    <a href="{{ product.url}}" class="s-card__link"></a>
    <div class="s-card__tags">
      
      {% comment %} {% assign first_collection = product.collections.first %}
      {% if first_collection %}
        <span class="tag">{{ first_collection.title }}</span>
      {% endif %} {% endcomment %}


      {% assign exclude_collection_handle = 'all' %}
      {% for collection in product.collections %}
        {% unless collection.handle == exclude_collection_handle %}
          <span class="tag">{{ collection.title }}</span>
          {% break %}
        {% endunless %}
      {% endfor %}

      {% if product.compare_at_price > product.price %}
        <span class="tag tag--off">{% if product.compare_at_price_max > product.price %}{{ product.compare_at_price_max | minus: product.price | times: 100.0 | divided_by: product.compare_at_price_max | money_without_currency | times: 100 | remove: '.0'}}% off{% endif %}</span>
      {% endif %}
    </div>

    <div class="s-card__img-offset"></div>
    
    <div class="s-card__img">

      {% if product.metafields.custom.isolated_image %}
        <img src="{{ product.metafields.custom.isolated_image | img_url: '' }}" alt="" width="778" height="340">
      {% else %}
        <img src="{{ product.images.first | img_url: 'master' }}" alt="" width="778" height="340">
      {% endif %}

      {% if product.metafields.custom.hover_image %}
        <img src="{{ product.metafields.custom.hover_image | img_url: '' }}" alt="" width="778" height="340">
      {% else %}
        <img src="{{ product.images.last | img_url: 'master' }}" alt="" width="778" height="340">
      {% endif %}

    </div>
    <div class="s-card__title title-h4">
      <h3>{{ product.title }}</h3>
    </div>
    <div class="s-card__text">
      <p>{{ product.price | money }}</p>
    </div>
    <a href="{{ product.url}}" class="s-card__btn">
      <div class="s-arrow-link">
        <span>View Details</span>
        <div class="s-arrow-link__ico">
          <svg xmlns="http://www.w3.org/2000/svg" width="32" height="14" viewBox="0 0 32 14">
            <g id="Group_11387" data-name="Group 11387" transform="translate(-177 -1807)">
              <line id="Line_17" data-name="Line 17" x2="25" transform="translate(177 1814)" fill="none" stroke="#1f454d" stroke-miterlimit="10" stroke-width="1"/>
              <path id="Path_1178" data-name="Path 1178" d="M34,0a7,7,0,0,0,7,7,7,7,0,0,0-7,7" transform="translate(168 1807)" fill="none" stroke="#1f454d" stroke-linejoin="bevel" stroke-width="1"/>
            </g>
          </svg>
          <svg xmlns="http://www.w3.org/2000/svg" width="32" height="14" viewBox="0 0 32 14">
            <g id="Group_11387" data-name="Group 11387" transform="translate(-177 -1807)">
              <line id="Line_17" data-name="Line 17" x2="25" transform="translate(177 1814)" fill="none" stroke="#1f454d" stroke-miterlimit="10" stroke-width="1"/>
              <path id="Path_1178" data-name="Path 1178" d="M34,0a7,7,0,0,0,7,7,7,7,0,0,0-7,7" transform="translate(168 1807)" fill="none" stroke="#1f454d" stroke-linejoin="bevel" stroke-width="1"/>
            </g>
          </svg>
        </div>
      </div>
    </a>
  </div>
</article>
{% endif %}